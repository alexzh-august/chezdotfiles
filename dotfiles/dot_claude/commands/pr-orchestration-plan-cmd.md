# TDD Feature Planning with Orchestration

This command initiates comprehensive TDD-based feature planning using the orchestration agent.

## Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 1: PARALLEL DISCOVERY                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”â”‚
â”‚  â”‚ E1  â”‚ â”‚ E2  â”‚ â”‚ E3  â”‚ â”‚ E4  â”‚ â”‚ E5  â”‚ â”‚ E6  â”‚ â”‚ E7  â”‚ â”‚ E8  â”‚ â”‚...â”‚â”‚
â”‚  â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”˜â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                              â–¼                                       â”‚
â”‚                    Context Synthesis                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 2: TDD PLANNING                                â”‚
â”‚                                                                         â”‚
â”‚     For each component:                                                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ ğŸ”´ RED  â”‚â”€â”€â”€â”€â”€â–¶â”‚ ğŸŸ¢ GREENâ”‚â”€â”€â”€â”€â”€â–¶â”‚ğŸ”µREFACTORâ”‚                      â”‚
â”‚     â”‚ Tests   â”‚      â”‚  Impl   â”‚      â”‚ Quality â”‚                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 3: CRITIC REVIEW                               â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚     â”‚   TDD Plan      â”‚â”€â”€â”€â”€â”€â–¶â”‚   @agent        â”‚                       â”‚
â”‚     â”‚   Document      â”‚      â”‚   pr-critic     â”‚                       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                       â”‚                                 â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                              â”‚ APPROVED â”‚ NEEDS â”‚                       â”‚
â”‚                              â”‚          â”‚REVISIONâ”‚                       â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 4: ITERATION (if needed)                       â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚     â”‚ Parse   â”‚â”€â”€â”€â”€â”€â–¶â”‚ Revise  â”‚â”€â”€â”€â”€â”€â–¶â”‚Re-Reviewâ”‚                      â”‚
â”‚     â”‚Feedback â”‚      â”‚  Plan   â”‚      â”‚         â”‚                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                         â”‚
â”‚     Expected: 1-3 iterations based on complexity                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PHASE 5: DEVELOPER REVIEW                            â”‚
â”‚                                                                         â”‚
â”‚     Present final plan with options:                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚     â”‚ APPROVE â”‚   â”‚  REQUEST    â”‚   â”‚ REJECT  â”‚                        â”‚
â”‚     â”‚         â”‚   â”‚  CHANGES    â”‚   â”‚         â”‚                        â”‚
â”‚     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                        â”‚
â”‚          â”‚               â”‚               â”‚                              â”‚
â”‚          â–¼               â–¼               â–¼                              â”‚
â”‚     Implement      Another Cycle    New Requirements                   â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Usage

```
/pr-orchestration-plan-cmd [feature description]
```

## Process

### Phase 1: Parallel Discovery

The orchestration agent launches **10 explore agents simultaneously**:

| Agent | Focus |
|-------|-------|
| 1 | Codebase structure & entry points |
| 2 | Package dependencies & versions |
| 3 | Code patterns & naming conventions |
| 4 | Test infrastructure & fixtures |
| 5 | Modern AI/ML solutions |
| 6 | Similar existing features |
| 7 | Configuration & feature flags |
| 8 | API patterns & error handling |
| 9 | Database models & migrations |
| 10 | CI/CD pipeline & quality gates |

### Phase 2: TDD Plan Creation

For each feature component, creates a complete TDD cycle:

**ğŸ”´ RED - Write Failing Tests**
- Test file location
- Test function specifications
- Expected assertions
- Why tests will initially fail

**ğŸŸ¢ GREEN - Minimal Implementation**
- Exact file changes needed
- Code to add/modify
- Dependencies required
- Expected: tests pass

**ğŸ”µ REFACTOR - Improve Quality**
- Pattern alignment
- Performance optimization
- Code simplification
- Expected: tests still pass

### Phase 3: Critic Review

Invokes the PR Critic agent to evaluate:
- TDD cycle completeness
- Python standards conformance
- Modern best practices
- Test coverage adequacy

Verdicts: `APPROVED` | `APPROVED WITH NOTES` | `NEEDS REVISION` | `MAJOR REWORK`

### Phase 4: Iteration

If feedback received:
1. Parse feedback by category (Critical/Suggestions/Minor)
2. Update affected TDD cycles
3. Document changes
4. Request re-review

Expected iterations: 1-3 based on complexity

### Phase 5: Developer Review

Final plan presented with:
- Executive summary
- TDD cycle breakdown
- File change manifest
- Test coverage map
- Risk assessment
- Approval request

## Output Format

```markdown
# TDD FEATURE PLAN
==================
Feature: [Name]
Status: [DRAFT | REVIEWED | APPROVED]
TDD Cycles: [N]

## Executive Summary
[2-3 sentences]

## Discovery Summary
[Key findings from explore agents]

## TDD Implementation Plan

### Cycle 1: [Component]

#### ğŸ”´ RED - Failing Tests
[Test specifications]

#### ğŸŸ¢ GREEN - Minimal Implementation
[Implementation steps]

#### ğŸ”µ REFACTOR - Improve Quality
[Improvements]

## File Change Manifest
| File | Action | Phase |

## Test Coverage
- Unit: [List]
- Integration: [List]

## Risks & Mitigations
| Risk | Likelihood | Impact | Mitigation |

## Approval
- [x] Critic: [VERDICT]
- [ ] Developer: PENDING
```

## Example

```
User: /pr-orchestration-plan-cmd Add user preference storage with REST API

Agent:
1. Launches 10 explore agents â†’ discovers pytest fixtures, SQLAlchemy models, FastAPI patterns
2. Creates TDD plan:
   - Cycle 1: Preference model (tests first)
   - Cycle 2: Preference repository
   - Cycle 3: API endpoints
3. Sends to pr-critic â†’ receives feedback
4. Iterates â†’ addresses feedback
5. Presents final plan â†’ awaits developer approval
```

## Tips

- Start with clear, specific feature descriptions
- Let discovery phase complete fully before proceeding
- Address all critical feedback before seeking approval
- Keep the plan updated if implementation reveals new information

## When Plan is Approved

1. Switch to auto-accept mode (shift+tab)
2. Follow TDD cycles exactly:
   - Write tests first (RED)
   - Implement minimally (GREEN)
   - Improve quality (REFACTOR)
3. Run tests after each phase
4. Use `/verify` after completion
